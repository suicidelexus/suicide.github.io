<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Аудитория: пол, возраст, интересы</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {font-family: 'Segoe UI', sans-serif; margin:0; background:#f5f7fa; color:#2d3748;}
    .container {max-width:1200px; margin:20px auto; background:white; padding:25px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.08);}
    h1 {text-align:center; color:#1a56db; margin-bottom:10px;}
    .summary {text-align:center; font-size:1.4em; font-weight:600; color:#1e40af; margin:15px 0;}
    .filters {display:flex; flex-wrap:wrap; gap:20px; margin:25px 0; padding:15px; background:#f8fafc; border-radius:10px;}
    .filter-group {flex:1; min-width:200px;}
    .filter-group h3 {margin:0 0 10px; font-size:1.1em; color:#1e293b;}
    .checkboxes {display:flex; flex-direction:column; gap:8px;}
    label {display:flex; align-items:center; gap:8px; font-size:0.95em; cursor:pointer; padding:6px 10px; border-radius:6px; transition:0.2s;}
    label:hover {background:#e0e7ff;}
    input[type="checkbox"] {accent-color:#3b82f6;}
    table {width:100%; border-collapse:collapse; margin:25px 0; font-size:0.95em;}
    th, td {border:1px solid #e2e8f0; padding:12px; text-align:center;}
    th {background:#3b82f6; color:white; font-weight:600;}
    tr:nth-child(even) {background:#f8fafc;}
    .chart-container {height:380px; margin:30px 0; position:relative;}
    .no-data {text-align:center; color:#94a3b8; font-style:italic; padding:40px;}
    @media (max-width:768px) {.filters {flex-direction:column;}}
  </style>
</head>
<body>
<div class="container">
  <h1>Анализ ёмкости аудитории в интернете</h1>
  <div class="summary">Итоговая аудитория: <span id="total">0</span> млн чел.</div>

  <div class="filters">
    <div class="filter-group">
      <h3>Пол</h3>
      <div class="checkboxes">
        <label><input type="checkbox" value="Мужчины" checked> Мужчины</label>
        <label><input type="checkbox" value="Женщины" checked> Женщины</label>
      </div>
    </div>
    <div class="filter-group">
      <h3>Возраст</h3>
      <div class="checkboxes">
        <label><input type="checkbox" value="18-24" checked> 18–24</label>
        <label><input type="checkbox" value="25-34" checked> 25–34</label>
        <label><input type="checkbox" value="35-44" checked> 35–44</label>
        <label><input type="checkbox" value="45+"> 45+</label>
      </div>
    </div>
    <div class="filter-group">
      <h3>Интересы</h3>
      <div class="checkboxes">
        <label><input type="checkbox" value="Спорт" checked> Спорт</label>
        <label><input type="checkbox" value="Технологии" checked> Технологии</label>
        <label><input type="checkbox" value="Мода"> Мода</label>
        <label><input type="checkbox" value="Игры"> Игры</label>
        <label><input type="checkbox" value="Красота"> Красота</label>
        <label><input type="checkbox" value="Путешествия"> Путешествия</label>
        <label><input type="checkbox" value="Еда"> Еда</label>
        <label><input type="checkbox" value="Авто"> Авто</label>
      </div>
    </div>
  </div>

  <table id="dataTable"><thead><tr><th>Пол</th><th>Возраст</th><th>Интерес</th><th>Ёмкость (млн)</th></tr></thead><tbody></tbody></table>
  <div class="chart-container"><canvas id="genderChart"></canvas></div>
  <div class="chart-container"><canvas id="ageChart"></canvas></div>
  <div class="chart-container"><canvas id="interestChart"></canvas></div>
</div>

<script>
// Реалистичные данные: 2025, РФ + СНГ, активные пользователи (в млн)
const data = [
  {g:'Мужчины',a:'18-24',i:'Спорт',c:4.2},
  {g:'Мужчины',a:'18-24',i:'Игры',c:6.8},
  {g:'Мужчины',a:'25-34',i:'Технологии',c:8.5},
  {g:'Мужчины',a:'25-34',i:'Авто',c:5.1},
  {g:'Мужчины',a:'35-44',i:'Спорт',c:3.9},
  {g:'Мужчины',a:'45+',i:'Авто',c:2.7},
  {g:'Женщины',a:'18-24',i:'Мода',c:5.6},
  {g:'Женщины',a:'18-24',i:'Красота',c:6.3},
  {g:'Женщины',a:'25-34',i:'Путешествия',c:7.1},
  {g:'Женщины',a:'25-34',i:'Еда',c:6.4},
  {g:'Женщины',a:'35-44',i:'Красота',c:4.8},
  {g:'Женщины',a:'45+',i:'Путешествия',c:3.2}
];

let charts = {};

function getSelected(arr) {
  return Array.from(document.querySelectorAll(`input[value][type="checkbox"]:checked`))
              .filter(cb => arr.includes(cb.closest('.filter-group').querySelector('h3').textContent))
              .map(cb => cb.value);
}

function filterData() {
  const selectedGender = Array.from(document.querySelectorAll('.filter-group h3:contains("Пол") ~ .checkboxes input:checked')).map(i => i.value);
  const selectedAge = Array.from(document.querySelectorAll('.filter-group h3:contains("Возраст") ~ .checkboxes input:checked')).map(i => i.value);
  const selectedInterest = Array.from(document.querySelectorAll('.filter-group h3:contains("Интересы") ~ .checkboxes input:checked')).map(i => i.value);

  return data.filter(d =>
    (selectedGender.length === 0 || selectedGender.includes(d.g)) &&
    (selectedAge.length === 0 || selectedAge.includes(d.a)) &&
    (selectedInterest.length === 0 || selectedInterest.includes(d.i))
  );
}

function updateAll() {
  const filtered = filterData();
  const total = filtered.reduce((s, d) => s + d.c, 0).toFixed(1);
  document.getElementById('total').textContent = total;

  // Таблица
  const tbody = document.getElementById('dataTable').querySelector('tbody');
  tbody.innerHTML = filtered.length ? filtered.map(r => 
    `<tr><td>${r.g}</td><td>${r.a}</td><td>${r.i}</td><td>${r.c}</td></tr>`
  ).join('') : '<tr><td colspan="4" class="no-data">Нет данных по выбранным фильтрам</td></tr>';

  // Графики
  destroyCharts();
  if (filtered.length === 0) return;

  // По полу
  const genderSum = {};
  filtered.forEach(d => genderSum[d.g] = (genderSum[d.g] || 0) + d.c);
  charts.gender = new Chart(document.getElementById('genderChart'), {
    type: 'doughnut',
    data: { labels: Object.keys(genderSum), datasets: [{ data: Object.values(genderSum), backgroundColor: ['#3b82f6', '#ec4899'] }] },
    options: { plugins: { title: { display: true, text: 'Распределение по полу' } }, responsive: true, maintainAspectRatio: false }
  });

  // По возрасту
  const ageSum = {};
  filtered.forEach(d => ageSum[d.a] = (ageSum[d.a] || 0) + d.c);
  charts.age = new Chart(document.getElementById('ageChart'), {
    type: 'bar',
    data: { labels: Object.keys(ageSum), datasets: [{ label: 'Ёмкость (млн)', data: Object.values(ageSum), backgroundColor: '#10b981' }] },
    options: { plugins: { title: { display: true, text: 'По возрасту' } }, responsive: true, maintainAspectRatio: false }
  });

  // По интересам
  const interestSum = {};
  filtered.forEach(d => interestSum[d.i] = (interestSum[d.i] || 0) + d.c);
  charts.interest = new Chart(document.getElementById('interestChart'), {
    type: 'radar',
    data: { labels: Object.keys(interestSum), datasets: [{ label: 'Ёмкость', data: Object.values(interestSum), backgroundColor: 'rgba(251,146,60,0.2)', borderColor: '#fb923c' }] },
    options: { plugins: { title: { display: true, text: 'По интересам' } }, responsive: true, maintainAspectRatio: false }
  });
}

function destroyCharts() {
  Object.values(charts).forEach(c => c?.destroy());
  charts = {};
}

// Автообновление при изменении
document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.addEventListener('change', updateAll));

// Инициализация
updateAll();
</script>
</body>
</html>
